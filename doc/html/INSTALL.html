<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="INDEX" href="index.html">
<link rev="MADE" href="mailto:nakahiro@sarion.co.jp">
<link rel="KINOBOARDS Home Page" href="http://www.jin.gr.jp/~nahi/kb/">
<link rel="StyleSheet" href="kinoStyle.css" type="text/css" media="screen">
<title>Installation</title>
</head>
<body>

<div class="header">
<h1>
Installation
</h1>

<p class="status">
Last Update: February 15, 2000
</p>
</div>

<hr>

<div class="main">
<p>
インストール方法は，初めてのインストールか，
それとも旧バージョンのバージョンアップかに応じて，
2種類にわかれています．
</p>

<ul>
<li><a href="#New">A. 初めてのインストール</a>
<li><a href="#Update">B. バージョンアップインストール</a>
</ul>

<h2><a name="New">A. 初めてのインストール</a></h2>

<p>
初めてのインストールの場合のインストール手順は，
あなたが利用するプロバイダ（ウェブサーバ）のCGI環境によって若干異なります．
CGI環境は，大きく分けて以下の4つに分類されます．
</p>

<ol>
<li>CGIプログラムを自由なディレクトリに置くことができる場合
<li>CGIプログラムを決まったディレクトリ（例えばcgi-bin等）に
置かなければならない場合
<li>プロバイダがCGIWRAPという，CGI起動ラッパープログラムを利用している場合
（具体的には，1999年6月時点で，Hi-Ho，interq等のプロバイダが
CGIWRAPを利用しています．
またCobalt Networks社のCobalt Cube 2700J，
Cobalt Raq J R15 125 NIUというサーバも，CGIWRAPを利用しているそうです）
<li>プロバイダがApacheのsuEXECという機能を利用している場合
（具体的には，2000年1月時点で，A-CUBE，X-Jam，BigNet等のプロバイダが
suEXECを利用しています）
</ol>

<p>
まずは自分の置かれたCGI環境を確認しましょう．
プロバイダの利用案内やFAQを見ると，
自分がどれにあてはまるかわかると思います．
ちなみに「2. CGIプログラムは決まったディレクトリに置く」と
「3. CGIWRAPを利用している」の両方にあてはまってしまう不幸な環境もあります．
例えばHi-Hoですね．^^;
とはいっても，注意深く設置すれば必ず動きます（動作実績もあります）．
頑張ってください．
</p>

<p>
それでは始めましょう．
インストールは以下の手順で進めてください．
</p>

<ol>
<li><a href="#DownLoad">ダウンロード</a>
<li><a href="#Expand">展開</a>
<li><a href="#kb.cgi">kb.cgiの書き換え</a>
<li><a href="#Put">ファイル送信</a>
<li><a href="#Mode">ファイルモードの設定</a>
<li><a href="#InitialTest">初期テスト</a>
<li><a href="#WwwTest">CGI動作テスト</a>
<li><a href="#Config">カスタマイズ</a>
<li><a href="#KbPhTest">設定ファイルテスト</a>
<li><a href="#LastTest">カスタマイズ掲示板動作テスト</a>
<li><a href="#Special">機能特別版のkb.cgiプログラムを作る</a>
<li><a href="#MailPost">メイル投稿機能を使う</a>
</ol>

<p>
10まで（必要だったら12まで）くればインストールは終わりです．
システムをインストールして頂きましたら，
<a href="http://www.jin.gr.jp/~nahi/kv.cgi?b=example">きのぼずインストーラリスト</a>
にある，アンケートに御協力ください．
今後の開発の参考にしますので，どうかよろしくお願いします．
</p>

<h3><a name="DownLoad">1. ダウンロード</a></h3>

<p>
最新版の
<a href="http://www.jin.gr.jp/~nahi/src/perl.shtml#KINOBOARDS">圧縮パッケージ</a>
をダウンロードして，自分のパソコンに保存してください．
</p>

<h3><a name="Expand">2. 展開</a></h3>

<p>
圧縮パッケージを展開します．
自分のパソコン上で，伸長・展開ツールを利用して，
圧縮パッケージを展開してください．
</p>

<p>
圧縮パッケージを展開すると，KB_v10〜というディレクトリと，
そのディレクトリの中にいくつかのファイルとディレクトリが作られます．
下の図において，後ろに「/」がついているのはディレクトリを，
そうでないものはファイルを示します．
各ディレクトリおよびファイルの役割については，
<a href="MANIFESTO.html">MANIFESTOドキュメント</a>
を御覧ください．
</p>

<blockquote>
<pre>
+-KB_v10〜/
   +-COPYING
   +-README
   +-doc/
   |  +-html/
   |     :
   |
   +-kb/
   |  +-UI/
   |  |  :
   |  |
   |  +-board/
   |  |  +-kb.aid
   |  |  +-kb.board
   |  |  +-kb.db
   |  |
   |  +-cgi.pl
   |  +-icons/
   |  |  :
   |  |
   |  +-index.html
   |  +-index.shtml
   |  +-jcode.pl
   |  +-kb.cgi
   |  +-kb.ph
   |  +-kinoboards
   |  +-kinologue.pl
   |  +-kinousers
   |  +-log/
   |  +-mimer.pl
   |  +-mimew.pl
   |  +-test/
   |     +-kb.aid
   |     +-kb.board
   |     +-kb.db
   |
   +-tools/
   |  +-conv.cgi
   |  +-kbTst.cgi
   |  :
   |
   +-redist/
      :
</pre>
</blockquote>

<p>
作成されたファイル群の中の「kb」というディレクトリが，
CGIプログラム用パッケージを収めたディレクトリです．
このディレクトリをまるごとプロバイダ（ウェブサーバ）に置く必要があります
（まだ送らないでください; もうちょっと待ってね）．
その他のファイル（COPYING，README，doc/，redist/）は
あなたのパソコンに保管しておいてください．
</p>

<h3><a name="kb.cgi">3. kb.cgiの書き換え</a></h3>

<p>
さーて，最初のヤマです．ファイルの書き換えが必要です．
</p>

<p>
kb.cgiというファイルの先頭行には，
KINOBOARDSを動かすために必要なperlというプログラムのパスが書かれています．
予め一般的な設定がされていますが，
プロバイダ（ウェブサーバ）に依って違うため，
調べて正しく設定しなければなりません．
</p>

<p>
perlのパスについては，プロバイダの利用案内やFAQを探してみてください．
「/usr/bin/perl」や「/usr/local/bin/perl」などのパスが
指定されているはずです．
どうしてもみつからなければ管理者に問い合わせてみましょう．
</p>

<p>
perlのパスがわかったら，kb.cgiを書き換えます．
圧縮パッケージをプロバイダのマシン上で展開した人は，
まずFTPソフトウェアでkb.cgiを自分のパソコンに取ってきましょう．
kb.cgiを適当なエディタで開いて，先頭行を書き換えてください．
「#!」に続けて，perlのパスを書き込みます．
</p>

<blockquote>
<pre>
例: Perlのパスが/usr/bin/perlだった場合

#!/usr/local/bin/perl → #!/usr/bin/perl
</pre>
</blockquote>

<p>
続いて$KBDIR_PATHに，プロバイダ（ウェブサーバ）に置く予定の
kbディレクトリのパス（URLじゃなくて，パスです）を指定します．
「kbディレクトリのパスがわからない!」という場合は，
<a href="#kbTst.cgi">kbTst.cgiというツールを使ってチェック</a>
することができます．
</p>

<blockquote>
<pre>
例1: kbディレクトリのパスが「/home/nahi/public_html/kb/」になる予定の場合

$KBDIR_PATH = '';
↓
$KBDIR_PATH = '/home/nahi/public_html/kb/';


例2: サーバがWinNTで，kbディレクトリのパスが「c:\inetpub\wwwroot\kb\」になる予定の場合

$KBDIR_PATH = '';
↓
$KBDIR_PATH = 'c:\inetpub\wwwroot\kb\';
</pre>
</blockquote>

<p>
さらに，サーバOSがWin95/Win98，もしくはMacの場合
（プロバイダがこれらのマシンをサーバにすることはないでしょうから，
自分のパソコンでテストする場合ですね），
kb.cgiの続く3つ目の項目を，以下のように書き換えます．
サーバがWin95/Win98，Macでない場合は書き換える必要はありません．
</p>

<blockquote>
<pre>
$PC = 0;        # for UNIX / WinNT
# $PC = 1;      # for Win95 / Mac

↓

# $PC = 0;      # for UNIX / WinNT
$PC = 1;        # for Win95 / Mac
</pre>
</blockquote>

<p>
さらにさらに，<a href="#New">最初に書いた</a>
4種類のCGI環境のうち「3. CGIWRAPを利用している」場合は，
4つ目の項目にkbディレクトリのURL（今度はパスじゃなくて，URLです）
を指定します．そうでない環境の場合，設定の必要はありません．
</p>

<blockquote>
<pre>
例: kbディレクトリのURLが「/~nahi/bbs/kb/」になる予定の場合

# $KB_RESOURCE_URL = '/~nahi/kb/';
↓
$KB_RESOURCE_URL = '/~nahi/bbs/kb/';
</pre>
</blockquote>

<p>
この時，間違えて先頭部分以外を書き換えたり，
漢字コードを変更してしまったりしないようにしてください．
世の中にはSJISでも動くと謌っているPerlスクリプトもありますが，
基本的にPerlはEUCでなければ動きません．
SJISでも一見動いているように見えることがありますが，バグの素です．
必ずEUCにしましょう．
</p>

<h3><a name="Put">4. ファイル送信</a></h3>

<p>
<a href="#Expand">2. 展開</a>
でできたkbディレクトリを，
その中に含まれるファイル，ディレクトリごと，
プロバイダ（ウェブサーバ）に送信します．
もちろんkb.cgiは，
<a href="#kb.cgi">3. kb.cgiを書き換える</a>
で書き換えたものを送信してください．
</p>

<p>
ここで，<a href="#New">最初にも書いた</a>，
「1. CGIプログラムを自由なディレクトリに置くことができる」
環境の場合は，
下のディレクトリ構成図に示すように，
ウェブ用のディレクトリ（例ではpublic_html）にkbという名前のディレクトリを作り，
その中に各ファイルとディレクトリを設置してください．
</p>

<blockquote>
<pre>
+-public_html
   +-kb/
      +-UI/
      |  :
      |
      +-board/
      |  +-kb.aid
      |  +-kb.board
      |  +-kb.db
      |
      +-cgi.pl
      +-icons/
      |  :
      |
      +-index.html
      +-index.shtml
      +-jcode.pl
      +-kb.cgi
      +-kb.ph
      +-kinoboards
      +-kinologue.pl
      +-kinousers
      +-log/
      +-mimer.pl
      +-mimew.pl
      +-test/
         +-kb.aid
         +-kb.board
         +-kb.db
</pre>
</blockquote>

<p>
「1. CGIプログラムを自由なディレクトリに置くことができる」
環境の場合，送信は以上で終了です．
<a href="#Mode">5. ファイルモードの設定</a>に進んでください．
</p>

<p>
「2. CGIプログラムは決まったディレクトリに置く」
環境の場合，もうちょっとややこしいです．
ファイルを送る前に，まずindex.htmlを書き換えます．
index.htmlのソースを見ると，
「テスト」掲示板へのリンクが，
</p>

<blockquote>
<p>
&lt;a href=&quot;kb.cgi?b=test&quot;&gt;テスト&lt;/a&gt;
</p>
</blockquote>

<p>
となっていると思います．これを次のように変更してください．
</p>

<blockquote>
<p>
&lt;a href=&quot;<strong>(A)</strong>/kb.cgi<strong>(B)</strong>?b=test&quot;&gt;テスト&lt;/a&gt;
</p>
</blockquote>

<ul>
<li>(A): CGIプログラムを置くディレクトリのURL(例えば/cgi-bin/nahi)
<li>(B): kbディレクトリのURL(例えば/~nahi/kb)
</ul>

<p>
つまり，「kb.cgi」→「(A)/kb.cgi(B)」と変更します．上の例なら，
</p>

<blockquote>
<p>
&lt;a href=&quot;<strong>/cgi-bin/nahi</strong>/kb.cgi<strong>/~nahi/kb</strong>?b=test&quot;&gt;テスト&lt;/a&gt;
</p>
</blockquote>

<p>
になります．
</p>

<p>
index.htmlを書き換えたら，いよいよ設置です．
まず，プロバイダから指示されている，
CGIスクリプトを置かなければならないディレクトリに，
kb.cgi（だけ!）を置いてください．
次にkbという名前のディレクトリの中に，
残りの（kb.cgi以外の）ファイルとディレクトリを置いてください．
</p>

<p>
ファイル構成は，例えば以下のようになります．
</p>

<blockquote>
<pre>
CGIプログラムを置くディレクトリ
   +-cgi-bin
      +-kb.cgi

kbディレクトリ
   +-public_html
      +-kb/
         +-UI/
         |  :
         |
         +-board/
         |  +-kb.aid
         |  +-kb.board
         |  +-kb.db
         |
         +-cgi.pl
         +-icons/
         |  :
         |
         +-index.html
         +-index.shtml
         +-jcode.pl
         +-kb.ph
         +-kinoboards
         +-kinologue.pl
         +-kinousers
         +-log/
         +-mimer.pl
         +-mimew.pl
         +-test/
            +-kb.aid
            +-kb.board
            +-kb.db
</pre>
</blockquote>

<h3><a name="Mode">5. ファイルモードの設定</a></h3>

<p>
次に，プロバイダ（ウェブサーバ）に設置した
各ファイルとディレクトリのモード（パーミッション）を変更します．
ファイルがたくさんあって大変ですが，頑張ってください．
</p>

<p>
<a href="#New">4種類のCGI環境</a>
のうち，「4. suEXECを利用している」
<strong>じゃない</strong>
場合は，以下のように設定してください．
「3. CGIWRAPを利用している」方もこちらの設定で試してみてください．
</p>

<blockquote>
<pre>
+-public_html
   +-kb/               777
      +-UI/            755
      |  :             444（UIディレクトリの中の〜.plというファイル）
      |
      +-board/         777
      |  +-kb.aid      666
      |  +-kb.board    666
      |  +-kb.db       666
      |
      +-cgi.pl         444
      +-icons/         755
      |  :             444（iconsディレクトリの中の〜.idef，〜.gifというファイル）
      |
      +-index.html     644
      +-index.shtml    644
      +-jcode.pl       444
      +-kb.ph          644
      +-kinoboards     644
      +-kinologue.pl   444
      +-kinousers      666
      +-log/           777
      +-mimer.pl       444
      +-mimew.pl       444
      +-test/          777
         +-kb.aid      666
         +-kb.board    666
         +-kb.db       666

  kb.cgi               755（kbディレクトリに置いた場合も，例えば/cgi-binに置いた場合も）</pre>
</blockquote>


<p>
「4. suEXECを利用している」
の環境の場合は，以下のように設定します．右側2つの数字が一部0になります．
</p>

<blockquote>
<pre>
+-public_html
   +-kb/               755
      +-UI/            700
      |  :             400（UIディレクトリの中の〜.plというファイル）
      |
      +-board/         700
      |  +-kb.aid      600
      |  +-kb.board    600
      |  +-kb.db       600
      |
      +-cgi.pl         400
      +-icons/         755
      |  :             644（iconsディレクトリの中の〜.idef，〜.gifというファイル）
      |
      +-index.html     644
      +-index.shtml    644
      +-jcode.pl       400
      +-kb.ph          600
      +-kinoboards     600
      +-kinologue.pl   400
      +-kinousers      600
      +-log/           755
      +-mimer.pl       400
      +-mimew.pl       400
      +-test/          700
         +-kb.aid      600
         +-kb.board    600
         +-kb.db       600

  kb.cgi               700（kbディレクトリに置いた場合も，例えば/cgi-binに置いた場合も）
</pre>
</blockquote>

<p>
モード（パーミッション）の変更は
お使いのFTPソフトウェアでやっても構いませんし，
telnetしてログインした後，chmodコマンドで行っても構いません．
</p>

<h3><a name="InitialTest">6. 初期テスト</a></h3>

<p>
念のためここでプログラムのテストをします．
<a href="#kbTst.cgi">kbTst.cgiというツールを使ってテスト</a>
してください．
プロバイダにtelnetできる人は，以下の方法でもテストできますが，
<a href="#kbTst.cgi">kbTst.cgi</a>
は大変便利なので，そちらでのテストをお勧めします．
<a href="#kbTst.cgi">kbTst.cgi</a>
でのテストに成功した場合，この項目は飛ばして
<a href="#WwwTest">7. CGI動作テスト</a>
に進んでください．
</p>

<p>
<a href="#kbTst.cgi">kbTst.cgiによるテスト</a>
がお勧めなら，何故この項目ごと削ってしまわないかというと．．．
kbTst.cgiがまだなかったころの名残りです．^^;
</p>

<p>
まずは送ったファイルが壊れてないかどうかのチェックをします．
telnetしてログインし，kb.cgiのあるディレクトリへ行ってから，
</p>

<blockquote>
<pre>
perl -c ./kb.cgi
</pre>
</blockquote>

<p>
と打ち込んでください．
</p>

<blockquote>
<pre>
./kb.cgi syntax OK
</pre>
</blockquote>

<p>
と表示されればOKです．
もしエラーメッセージ（parse error in 〜など）が表示されたら，
kb.cgiのPerlのパス以外の部分を書き換えてしまってないか，
漢字コードがSJISになってしまっていないかチェックしてください．
</p>

<h3><a name="WwwTest">7. CGI動作テスト</a></h3>

<p>
では，試しに動かしてみましょう．
index.htmlにアクセスし，タイトル一覧を表示をさせたり，
テスト掲示板に書き込んだりしてみてください．
ちゃんと動きましたか?
</p>

<p>
<a href="#InitialTest">6. 初期動作テスト</a>
に成功したのにエラーが出た人は，
各種ファイルのモード（パーミッション）を疑ってみてください．
初期動作テストができなかった人は，加えて
kb.cgiのPerlのパス以外の部分を書き換えてしまってないか，
漢字コードがSJISになってしまっていないかも，チェックしてください．
</p>

<h3><a name="Config">8. カスタマイズ</a></h3>

<p>
ここまでで，プログラムが正しく動作することが確認できました．
では次に，あなたの好みに合わせて掲示板の機能，見た目，
メッセージ等を変更しましょう．
一部，必ず変更しなければならない場所がありますので，
「このままでいいや」と読み飛ばしたりしないでくださいね．(^_^;
</p>

<p>
基本的なカスタマイズのために必要な操作は，
設定ファイルkb.phの書き換えだけです
（高度なカスタマイズについては，インストール後，
<a href="MAINT.html">MAINTENANCEドキュメント</a>
を参照してください）．
</p>

<p>
あなたのパソコンにあるkb.phを（プロバイダに送信したからって，
消しちゃ駄目ですよ．いざという時のために，とっておいてくださいね）
適当なエディタで開き，ファイルの中身を見てみてください．
この時，
Win95/Win98なら
<a href="http://www2.mitene.or.jp/maruo/">秀丸エディタ(お金がかかりますが……)</a>，
Macなら<a href="http://www.iijnet.or.jp/matsumoto/seihin/jedit/index.html">Jedit</a>
など，漢字コードが日本語EUCのファイルを
正しく表示できるエディタを使ってください．
現在のパソコンに付属しているエディタのほとんどは，
残念ながら漢字コードがSJISでないと正しく表示できません．
</p>

<p>
もしも上記エディタがどうしても手に入らない人は，
FTPソフトウェアでkb.phを取ってくる時に，
漢字コードを日本語EUCからSJISに変換するようにして，取ってきてみてください
（もちろん，お使いのソフトウェアにその機能があれば，ですが……）．
うまくいけば，パソコン付属のエディタでも正しく表示できるかもしれません．
</p>

<p>
うまくエディタで開けたら，kb.phを書き換えて，
きのぼーずをあなたのサイト用に設定し直してください．
設定の詳細はファイルに書かれています．
特に変更が必要なのは，
</p>

<ul>
<li>管理者の名前（$MAINT_NAME）
<li>管理者のメイルアドレス（$MAINT）
<li>掲示板システムの名前（$SYSTEM_NAME）
</ul>

<p>
です．忘れずに変更してくださいね．(^_^;
</p>

<p>
<strong>ただし!</strong>
記事の削除，訂正やメイル送信先の設定等の，
管理用のコマンドを使えるようにするか否かを設定する以下の部分は，
ここでは絶対に変更しないでください．
</p>

<blockquote>
<pre>
#
# これ以下のコマンドは必ず，
# 「正しくアクセス制限をかけた上で」利用してください．
# でないと破壊的な悪戯を匿名でやられ放題ですからね．
#
# [注意] スクリプトの名前を変えたくらいじゃ駄目ですよ．(^_^;
#
$SYS_F_D = 0;			# 記事の削除，訂正
$SYS_F_MV = 0;			# 記事の「前後順序/元記事-リプライ関係」の変更
$SYS_F_AM = 0;			# 新着記事到着時のメイル送信先の設定
</pre>
</blockquote>

<p>
理由は，コメントとして書いてある通りです．気をつけてくださいね．
この設定は，（必要なら）後に
「11. <a href="#Special">機能特別版のkb.cgiプログラムを作る</a>」
で行います．
</p>

<p>
ちなみに，このkb.phでカスタマイズ可能な各種機能を
ブラウザから設定可能にしてしまうツールがあります．
<a href="#kbTst.cgi">kbTst.cgi</a>
の作者，綾乃介さんの，
<a href="http://www5.big.or.jp/~aya/c_cgi/kbconf/">きのぼず/1.0 WWW設定ツール kbconf</a>
です．是非一度画面サンプルを見てみてください．
綺麗で機能的．なひにはないセンスです．．．
なひの能力不足で未だパッケージに含めるまでには至っていませんが，
とても便利なツールです．掲示板が増えてきたり，
kb.phを直接いじるのに疲れてきたら，是非導入にトライしてみてください．
</p>

<p>
変更が終わったら，
FTPソフトウェアでkb.phをプロバイダに送信してください．
モード（パーミッション）の設定も，再度行なってください．
先程kb.phを取ってくる時に漢字コードを日本語EUCからSJISに変換した人は，
SJISから日本語EUCに変換し直すようにして送ってくださいね．
kb.phの漢字コードは，必ず，日本語EUCでなければいけません．
</p>

<h3><a name="KbPhTest">9. 設定ファイルテスト</a></h3>

<p>
書き換えた設定ファイル，kb.phのテストをしましょう．
<a href="#InitialTest">6. 初期テスト</a>
と同じく，
<a href="#kbTst.cgi">kbTst.cgi</a>
を使ってテストしてください．
プロバイダにtelnetできる人は，以下の方法でもテストできますが，
<a href="#kbTst.cgi">kbTst.cgi</a>
は大変便利なので，そちらでのテストをお勧めします．
<a href="#kbTst.cgi">kbTst.cgi</a>
でのテストに成功した場合，この項目は飛ばして
<a href="#LastTest">10. カスタマイズ掲示板動作テスト</a>
に進んでください．
</p>

<p>
telnetしてログインし，kbディレクトリへ行ってから，
</p>

<blockquote>
<pre>
perl -c ./kb.ph
</pre>
</blockquote>

<p>
と打ち込んでください．
です．「syntax OK」と表示されればテストは成功です．
</p>

<p>
もしエラーメッセージ（parse error in 〜など）が表示されたら，
kb.phの書き方がどこか間違っている，ということです．
エラーメッセージの中に，間違っている行番号が書かれていますよね?
例えば
</p>

<blockquote>
<pre>
parse error in file kb.ph at line <strong>106</strong>, next token "〜
</pre>
</blockquote>

<p>
だったら，106行目付近が間違っているという意味です．
kb.phの106行目付近をチェックしてください．
特に，必要な「,」や「'」を間違って消してしまったりしがちですので，
注意してください．
</p>

<h3><a name="LastTest">10. カスタマイズ掲示板動作テスト</a></h3>

<p>
<a href="#WwwTest">7. CGI動作テスト</a>と同じく，
index.htmlにアクセスして，
カスタマイズした掲示板が正しく動作することを確認してください．
<a href="#WwwTest">7. CGI動作テスト</a>と
<a href="#KbPhTest">9. 設定ファイルテスト</a>
のテストに成功していれば，ここまで来てエラーが出ることはないはずです．
カスタマイズが気に入らなければ，
<a href="#Config">8. カスタマイズ</a>からやり直しましょう．
</p>

<p>
これで一通りの設定は終わりです．お疲れさまでした．
しばらくきのぼずで遊んでみてください．
</p>

<h3><a name="Special">11. 機能特別版のkb.cgiプログラムを作る</a></h3>

<p>
ここまでで，掲示板運営に必要な最小限の機能は揃っています．
ので，以降のインストールは特にやらなくても構いません．
見ての通り長いし，それにアクセス制限とか，結構設定が面倒ですし……．
</p>

<p>
<a href="#Config">8. カスタマイズ</a>でkb.phを変更した際，
一部の機能は必ずオフにしてくださいと書きました．
普通に考えれば，せっかく用意されている機能なんですから，
わざわざ「利用不可」になんてしたくないですよね．
</p>

<p>
では何故，「利用不可」にできるようになっているのか……
それは，ウェブサーバのアクセス制限機能を使うことによって，
</p>

<ul>
<li>管理者だけに，管理機能（記事の訂正や削除，メイル送信先の設定）
を使うことを許す．
<li>許された一部の人達だけが書き込みできるようにする（その他の人は読むだけ）．
</ul>

<p>
を実現するためなのです．例えばこの場合は，
</p>

<ul>
<li>管理機能を使えるkb.cgiプログラムを作り，
管理者だけがアクセスできるディレクトリに置く．
<li>通常のkb.cgiは書き込み不可としてインストールしておいて，
書き込み機能が使えるkb.cgiプログラムを，
一部のユーザだけがアクセスできるディレクトリに置く．
</ul>

<p>
ことで，必要なシステムを得ることができます．
</p>

<p>
前置きが長くて失礼しました．
ではそろそろ，具体的なインストール方法に入りましょう．
ただし<a href="#New">CGI環境</a>が
「2. CGIプログラムは決まったディレクトリに置く」環境の場合，
以下のやり方では，アクセス制限をかけられないんじゃないかと思います．
プロバイダによってやり方が異なると思いますので
（もしかしたら，アクセス制限のできないプロバイダもあるかも……），
詳しくはプロバイダの利用案内やFAQを見たり，問い合わせたりしてください．
</p>

<p>
基本的に，ディレクトリを作ってそこにアクセス制限をかけ，
kb.cgiとkb.phをコピーして，kb.phを書き換える，という作業になります．
</p>

<ol>
<li>新たにkb.cgiを置くディレクトリを決めます．
ここでは管理者専用のkb.cgiを作ってみましょう．

<blockquote>
<pre>
例)

~nahi (nahi用ディレクトリ)
   |
   +-- public_html (WWW用ディレクトリ)
           |
           +-- kb (きのぼーず1.0用ディレクトリ)
                 |
                 +-- priv (管理者用kb.cgiを置くディレクトリ)
</pre>
</blockquote>
<br>

<li>ディレクトリにアクセス制限をかけましょう．
<br>
ここでは管理者専用のkb.cgiを作るので，
もしあなたが，あなたしか使えない専用のマシンを持っているなら，
そのマシンからのみアクセスできるように設定しましょう．
そうでないなら，パスワードによるユーザ認証を行なうように設定します．
.htaccessや.nsconfigといったファイルの設定が必要ですが，
この設定方法もサーバの種類に依存します．
市販の参考書やウェブサイトを参考にするか，
プロバイダの利用案内やFAQを見たり，問い合わせたりしてください．
<br><br>

<li>FTPソフトウェアで，
すでにインストール済みのkb.cgiとkb.phを自分のパソコンに取ってきましょう．
そして<a href="#Config">8. カスタマイズ</a>を参考に，
取ってきたkb.phを設定し直してください．
<br>

<a href="#Config">8. カスタマイズ</a>では「利用可能にしてはダメ」
と書いた管理機能(記事の訂正や削除等)ですが，
ここでは利用可能に設定してみましょう．
<br><br>

<li>FTPソフトウェアで，
書き換えたkb.phを，サーバ内の，新たに作ったディレクトリに送ってください．
<br><br>

<li>もう動くはずです．
新設したkb.cgiのURLに続けて
「/(きのぼーず1.0ディレクトリのURL)?(コマンド指定)」を加え，
アクセスしてください．上の例なら，

<ul>
<li>kb.cgiのURLが「/~nahi/kb/priv/kb.cgi」，
<li>きのぼーず1.0ディレクトリのURLが「/~nahi/kb」，
<li>例えば，trial掲示板（b=trial）の記事を表示させるには，
<li>「/~nahi/kb/priv/kb.cgi/~nahi/kb?b=trial」にアクセスします．
</ul>
<br>

<li>最後に，アクセスを許された以外の人（ここではあなた以外の人）が，
新設したkb.cgiにアクセスできないことを確認しましょう．
もし他の人にアクセスできるようだと，悪戯のし放題になってしまいます．
もちろんこのプログラムによって生じたいかなる不都合に関しても，
私は責任を取れません．
</ol>

<p>
長々と御苦労様でした．これで機能特別版kb.cgiの出来上がりです．
KINOBOARDS/1.0の様々な機能が，
あなたのウェブサイト作成のお役に立てることを祈ってます．
</p>

<h3><a name="MailPost">12. メイル投稿機能を使う</a></h3>

<p>
きのぼずでは，コマンドラインから，
</p>

<p>
<tt>% <b>kb.cgi</b> <i>掲示板ID</i> POST</tt>
</p>

<p>
のように起動したコマンドの標準入力に対してメイルを流し込むと，
指定した掲示板に対して記事を新規投稿することができます．
残念ながら今のところ，リプライを投稿することはできません．
使い方によっては便利な機能ですが，
設定を間違うとエラーメイルを引き起こし，
各地の管理者さんに御迷惑をおかけすることになってしまいます．
くれぐれも，慎重に設定してくださいね．
</p>

<p>
また，後で詳しく書きますが，
あなたが管理者権限を持っていない場合，
この機能が使えるか否かは，管理者さんの設定次第です．
もし動かないようでしたら，管理者さんに相談してみてください．
</p>

<ol>
<li>もしあなたが管理者権限を持っている場合，つまり管理者なら，
/etc/aliasesに
<pre>
post-kb: &quot;|/home/nahi/public_html/kb/kb.cgi test POST &quot;
</pre>
というエントリを追加してください．
「post-kb」がメイル投稿用の宛先（変更しても構いません），
「/home/nahi/public_html/kb/kb.cgi」がkb.cgiの絶対パス，
「test」が掲示板IDです．「POST」はそのまま入力してください．
こうすることによって，post-kb宛の全てのメイルが，
自動的にtest掲示板に投稿されるようになります．<br>
掲示板IDはkinoboardsファイルで設定します．
kinoboardsファイルについては，
<a href="MAINT.html#addboard">「メンテナンス: 掲示板を新設する」</a>
を参照してください．
<br><br>

<li>管理者権限を持っていない場合は，
あなたのホームディレクトリの.forwardというファイルに，
以下のように記述してみてください．
<pre>
\nahi, &quot;|/home/nahi/public_html/kb/kb.cgi test POST_IF &quot;
</pre>
「nahi」はあなたのメイルアカウント（nahiのままじゃ駄目ですよ ^^;），
「/home/nahi/public_html/kb/kb.cgi」がkb.cgiの絶対パス，
「test」が掲示板IDです．「POST_IF」はそのまま入力してください．
こうすることによって，あなた宛のメイルが
自動的にtest掲示板に投稿されるようになります．<br>
<strong>ただし!</strong>
全てのメイルが投稿されてしまうわけではありません
（そんなことになったら大変だ ^^;）．
メイルのヘッダもしくは本文中に，
行頭から「x-kb-command: POST」と書かれているメイルのみ，投稿されます．
メイル投稿したい場合は，自分宛にメイルを書き，その本文中に
「x-kb-command: POST」という行を入れてください．
</ol>

<p>
.forwardファイルに上記設定を行なって上手くいくかどうかは，
そのサイトの管理者さんの設定次第です．
そのサイトのメイルホストにあなたのホームディレクトリがマウントされていて，
かつMTAがホームディレクトリの.forwardを参照するように
configureされていなければなりません．．．
</p>

<p>
正直なところ，一般のプロバイダでこのような設定になっているところは
少ないんじゃないかと思います．
</p>

<h3><a name="kbTst.cgi">13. kbTst.cgiできのぼず実行環境テスト</a></h3>

<p>
きのぼずのパッケージには，
綾乃介さん(aya@big.or.jp)が作ってくださった，
kbTst.cgiというCGIプログラムが含まれています．
kbTst.cgiは，きのぼずの実行環境をテストするためのCGIプログラムです．
kb.cgiと同じディレクトリにインストールし，
ブラウザからアクセスするだけで，
きのぼずが正しく動作するための準備が整っているかどうかをチェックしてくれます．
</p>

<p>
では実際に動かしてみましょう．
</p>

<p>
kbTst.cgiというファイルの先頭行には，
<a href="#kb.cgi">kb.cgiと同じく</a>，
perlというプログラムのパスが書かれています．
予め一般的な設定がされていますが，調べて正しく設定しなければなりません．
</p>

<p>
perlのパスについては，プロバイダの利用案内やFAQを探してみてください．
「/usr/bin/perl」や「/usr/local/bin/perl」などのパスが
指定されているはずです．
どうしてもみつからなければ管理者に問い合わせてみましょう．
</p>

<p>
perlのパスがわかったら，kbTst.cgiを書き換えます．
パッケージのtoolsディレクトリに含まれているkbTst.cgiを適当なエディタで開いて，
先頭行を書き換えてください．
「#!」に続けて，perlのパスを書き込みます．
</p>

<blockquote>
<pre>
例: Perlのパスが/usr/bin/perlだった場合

#!/usr/local/bin/perl → #!/usr/bin/perl
</pre>
</blockquote>

<p>
この時，間違えて先頭行以外を書き換えたり，
漢字コードを変更してしまったりしないようにしてください．
</p>

<p>
書き換えが終了したら，kbTst.cgiを，
<a href="#Put">プロバイダ（ウェブサーバ）の，kb.cgiと同じディレクトリ</a>
に送信してください．
この時，kbTst.cgiのモード（パーミッション）は755にしてください
（もしエラーが出るようなら，700や705も試してみてください）．
</p>

<p>
ここまでで設置完了です．
ウェブブラウザから，kbTst.cgiにアクセスしてみてください．
きのぼずが正しく動作するための準備が整っているかどうかの診断結果が，
ブラウザの画面上に表示されます．
たくさんの項目についてチェックしてくれますが，
もし「エラー」と表示された項目があったら，
表示されるアドバイスに従って設定をチェックしてみてください．
</p>

<p>
<a href="http://www.jin.gr.jp/~nahi/kb10.shtml">きのぼずのサポート掲示板</a>
でも，みなさんからの「インストールできない!」という問題の多くが，
このkbTst.cgiによって解決されています．
ほんとに便利なツールです．
このような大変便利なツールを，
きのぼずのパッケージに含めてみなさんに配布できることを，
大変光栄に思います．綾乃介さん，どうもありがとうございました．
</p>


<h2><a name="Update">B. バージョンアップインストール</a></h2>

<p>
古いKINOBOARDSをバージョンアップをするには，
プロバイダのマシンにtelnetできる必要があります．
telnetできない人は……基本的に，
古いバージョンの時に書き込まれた記事は諦めてください．
</p>

<p>
古いシステムの掲示板ディレクトリを全部自分のパソコンにFTPでもってきて，
次に新しいシステムにFTPで送り直せばいいんですが……
記事ファイルは大量にあるし……
それが面倒でない方は，チャレンジしてみてください．(^_^;
</p>

<ol>
<li>telnetして旧システムのkbディレクトリへ行き，
念のためバックアップを取ってください．
もし記事が消えたり，設定が変わって動かなくなっても，責任は取れません(^_^;．
バックアップは必ず取っておいてくださいね．

<blockquote><pre>
cd ~/public_html/kb		← KINOBOARDSをインストールしてあったディレクトリへ
chmod a-x kb.cgi		←kb.cgiの実行権をなくす
cd ..
tar cvfp kb10_old.tar kb
</pre></blockquote>
<br>

<li>できたkb10_old.tarがバックアップファイルなので，
gzipで圧縮し，消さずに残しておいてください
(gzipで圧縮すると，ファイル名はkb10_old.tar.gzになります)．

<blockquote>
<pre>
gzip kb10_old.tar
</pre>
</blockquote>
<br>

<li>KINOBOARDSを新しくインストールするため，
kbのディレクトリの名前を，古いものであるとわかるように変更してください．

<blockquote>
<pre>
cd ~/public_html		← KINOBOARDSをインストールしてあったディレクトリへ
mv kb kb_old
</pre>
</blockquote>
<br>

<li><a href="#New">新しいバージョンのKINOBOARDSを，
kbディレクトリにインストールし直してください</a>．
<br><br>

<li>新しくインストールしたKINOBOARDSのディレクトリ(kb)から，
掲示板ディレクトリ，「kinoboards」ファイル，「kinousers」ファイルを
削除してください．

<blockquote>
<pre>
cd ~/public_html/kb		← 新しくインストールしたKINOBOARDSへ
rm -rf test			← test掲示板を削除
rm -rf board			← board掲示板を削除
rm kinoboards			← 登録掲示板情報を削除
rm kinousers			← ユーザエイリアス情報を削除
</pre>
</blockquote>
<br>

<li>古いバージョンのKINOBOARDSから，掲示板ディレクトリ，
「kinoboards」ファイル，「kinousers」ファイルをコピーしてください．

<blockquote>
<pre>
cd ~/public_html/kb		← 新しくインストールしたKINOBOARDSへ
cp -pr ../kb_old/test test	← test掲示板をコピー
cp -pr ../kb_old/board board	← board掲示板をコピー
 :				← インストール後に作成した掲示板があれば，
 :				← 同様にコピーしてください．
cp -p ../kb_old/kinoboards .	← 登録掲示板情報をコピー
cp -p ../kb_old/kinousers .	← ユーザエイリアス情報をコピー
</pre>
</blockquote>
<br>

<li>R5.4以前と最新のバージョンでは，
一部使用しているファイルの名前が違います．
R5.4以前のシステムからバージョンアップする場合，
ファイル形式の変換を行う必要があります．
パッケージ中のtoolsディレクトリにconv.cgiというperlプログラムを用意したので，
これをkbディレクトリにコピーしてから，起動してください．
conv.cgiもperlで書かれていますので，
kb.cgiと同じく，先頭行のperlのパスを必要に応じて書き換える必要があります．

<blockquote>
<pre>
                                   まずconv.cgiをkbディレクトリにコピーする
cd ~/public_html/kb		← 新しくインストールしたKINOBOARDSへ
./conv.cgi			← 変換プログラムを起動
rm conv.cgi                     ← 実行してしまったら削除する
</pre>
</blockquote>

このプログラムは名前の通り，
CGI scriptとしてブラウザから起動してもかまいません．
以下のような表示がされれば終了です．

<blockquote>
<pre>
Content-type: text/plain			← conv.cgiの表示

rename: test/.db -> test/kb.db			← 名前が変更されたことを示す
rename: test/.board -> test/kb.board
rename: test/.articleid -> test/kb.aid
rename: board/.db -> board/kb.db
rename: board/.board -> board/kb.board
rename: board/.articleid -> board/kb.aid
older release -> R5.6 conversion succeeded.	← succeededと表示されれば成功
Renamed 6 file(s).				← 6つのファイルが変更された
</pre>
</blockquote>
<br>

<li>以上でバージョンアップは終わりです．正しく動くかどうか試してみてください．
</ol>
</div>

<hr>

<div class="footer">
<address>
<a href="http://www.jin.gr.jp/~nahi/kb/">KINOBOARDS: Kinoboards Is Network Opened BOARD System</a>.<br>
Copyright (C) 1995-2000
<a href="http://www.jin.gr.jp/~nahi/">NAKAMURA, Hiroshi</a>.
</address>
</div>
</body>
</html>
