<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML i18n//EN">
<html>
<head>
<title>WinNT4.0+IIS installation</title>
</head>
<body>

<h1>WinNT4.0+IISでのインストール手順</h1>

(オリジナルは <a href="http://www.kinotrope.co.jp/‾nakahiro/kb.cgi?b=k&c=e&id=667">&lt;URL:http://www.kinotrope.co.jp/‾nakahiro/kb.cgi?b=k&c=e&id=667&gt;</a> にあります．
藤塚さんがWhiteDay Release用に書いてくださったものを，
なひがR5.0用に一部書き換えています．)
<hr>
<p>
<pre>藤塚＠富士通大分ソフトです。

田中＠JETONさんの協力により、WinNT+IISでのインストール手順ができました。
これから使用する人への参考になればと重います。

--- ここから
「きのぼーず」をWindowsNTで使用するため、以下の設定を行いました。
「きのぼーず」のインストールと一緒に見てください。

１．インストール
以下の手順でインストールします。
(1) きのぼーずのサイトからRelease 5.0の圧縮パッケージをダウンロードします。
(2) ダウンロードしたファイルを解凍します。
　　解凍方法は、FTPでUNIXに転送する方法と、自分のマシン上で行う方法があります。
　　以下は、FTPでUNIXに転送する方法で解凍した時の手順です。
(2-1) 転送したファイルを展開します。
　　gzip -dc kb10_50.tar.gz | tar xvfp -
　　※ tarのpオプション（パーミッションの値を変更しない）は忘れずに。
(2-2) kbというディレクトリが作成され、その中にプログラム本体が展開されます。
(2-3) kbディレクトリにあるファイルをディレクトリごとFTPでWindowsNTに転送します。
(3) 展開してできたディレクトリにjcode.plを置きます。
　　jcode.plは、
　　ftp://ftp.sra.co.jp/pub/lang/perl/sra-scripts/
　　ftp://ftp.iij.ad.jp/pub/IIJ/dist/utashiro/perl/jcode.pl-2.3
　　のサイトなどからgetしてください。
(4) kbディレクトリにkb.lock(0バイト)のファイルを作成します。

２．Perlのインストール
以下の手順でPerlをインストールし、設定します。
Perlは、「WindowsNT 4.0 Server リソースキット」からインストールする方法と、FTPでサイトからgetする方法があります。
Perl5 for Win32(NTPerl)開発元と入手先は、
http://www.ActiveWare.com/
ftp://ftp.linux.ActiveWare.com/pub/Perl-Win32/beta/
ftp://ftp.linux.com/pub/Beta
で、必要なファイルとして
Pw32i30x.exe (Perl for Win32 Intel/x86 binary)
＃通常はこのファイルだけでよいと思います。
PlSEi30x.exe (PerlScript Intel/x86 binary, requires Perl for Win32)
PlISi30x.exe (Perl for ISAPI Intel/x86 binary, requires Perl for Win32)
Pw32s30x.zip (Perl for Win32 Source Files)
です。
(1) 「WindowsNT 4.0 Server リソースキット」からPerlをインストールします。
(2) インストール後、regedt32.exeを起動します。
　　[HKEY_LOCAL_MACHINE]ウィンドウをクリックし、
　　¥System¥CurrentControlSet¥Services¥W3SVC¥Parameters¥ScriptMap
　　に、値を追加します。［値の追加］ダイアログで、「データタイプ」にREG_SZ、
　　「値の名前」に.plを入力し、［文字列エディタ］ダイアログで、
　　（c:¥ntreskit¥perlディレクトリにperlをインストールしたとき）
　　c:¥ntreskit¥perl¥perl.exe %s
　　の文字列を入力します。
　　これで、.plの拡張子のファイルはすべてperl.exeを使って解釈することを、IISに指示したことになります。
(3) regedt32.exeを起動します。
　　[HKEY_LOCAL_MACHINE]ウィンドウをクリックし、
　　¥System¥CurrentControlSet¥Services¥W3SVC¥Parameters¥ScriptMap
　　に、値を追加します。［値の追加］ダイアログで、「データタイプ」にREG_SZ、
　　「値の名前」に.cgiを入力し、［文字列エディタ］ダイアログで、
　　（c:¥ntreskit¥perlディレクトリにperlをインストールしたとき）
　　c:¥ntreskit¥perl¥perl.exe %s
　　の文字列を入力します。
　　これで、.cgiの拡張子のファイルはすべてperl.exeを使って解釈することを、IISに指示したことになります。
(4) 変更を有効にするため、WWWサービスを停止し、再起動します。

３．共通のディレクトリにCGIを置く場合の設定
以下の手順で設定を行います。
(1) kb.cgiをc:¥ntreskit¥perl（perlをインストールしたディレクトリ）の下に移動させます。
(2) IISでc:¥ntreskit¥perlを仮想ディレクトリ/cgi-binで公開します。
　　このとき、実行権も与えます。
(2) index.htmlとtest/.boardファイルを修正します。
　　修正方法については、きのぼーずのdoc¥install.htmlに書かれています。

４．SSIの設定
SSIは#include文しか使えませんでした。
（ActiveServerPagesをインストールしなければ、#exec, #flastmodなどが使えないようです）
以下の手順で設定を行います。
(1) index.htmlをindex.stmに拡張子を変更します。

	/	/	/

自分で設定を行っているときに発生したエラーと原因です。
［メッセージ］
 HTTP/1.0 500 サーバー エラー (/home/kb/kb.cgi は有効な Windows NT アプリケーションではありません。 ) 
［原因］
.cgiの拡張子がPerlに関係づけられていないためです。

［メッセージ］
CGI エラー
指定された CGI アプリケーションは、HTTP ヘッダーを一部しか返していません。返されたヘッダーは:
Can't locate kb.ph in @INC (did you run h2ph?) at I:¥home¥kb¥kb.cgi line 46.
［原因］
index.htmlで書いている掲示板へのリンクを修正していなかったためです。

［メッセージ］
きのぼーず: ERROR!
システムのロックに失敗しました．混み合っているようですので，数分待ってからもう一度アクセスしてください．
何度アクセスしてもロックされている場合，メンテナンス中である可能性もあります．
［原因］
kbディレクトリにkb.lockがなかったためです。
--- ここまで

</pre></p>
<p>------------------------------</p>
</body>
</html>
